
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // The main collection is 'users'
    match /users/{userId} {

      // A user can create, read, and update their own profile document.
      // We are not allowing deletion of user profiles from the app.
      allow read, update, create: if request.auth != null && request.auth.uid == userId;

      // Rules for the 'accounts' subcollection
      match /accounts/{accountId} {
        // A user can perform any action (create, read, update, delete) on their own accounts.
        allow read, write: if request.auth != null && request.auth.uid == userId;

        // Rules for the 'transactions' sub-subcollection
        match /transactions/{transactionId} {
          // A user can perform any action on transactions within their own accounts.
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }
      }

      // Rules for the 'notifications' subcollection
      match /notifications/{notificationId} {
        // A user can perform any action on their own notifications.
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}
